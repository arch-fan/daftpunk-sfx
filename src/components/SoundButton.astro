---
import type { HTMLAttributes } from "astro/types";

interface Props extends HTMLAttributes<"button"> {
  sound: string;
}

const { sound, ...props } = Astro.props;
---

<button data-sound-name={sound.replace(" ", "")} {...props}>{sound}</button>

<script>
  const button = document.querySelectorAll("button[data-sound-name]");

  for (const btn of button) {
    const soundName = btn.getAttribute("data-sound-name");
    const originalAudio = new Audio(`/daftpunk-sfx/sounds/${soundName}.mp3`);

    originalAudio.setAttribute("preload", "auto");
    originalAudio.setAttribute("playsinline", "true");

    btn.addEventListener("click", () => {
      const audio = originalAudio.cloneNode() as HTMLAudioElement;
      audio.currentTime = 0;
      audio.play();

      btn.classList.add("!bg-opacity-100");

      audio.addEventListener("ended", () => {
        btn.classList.remove("!bg-opacity-100");
        audio.remove(); // Elimina el nodo duplicado para limpiar memoria
      });
    });
  }
</script>
